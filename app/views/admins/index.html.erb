<h1> <%= t('.users') %> </h1>



<%= form_for users_path, method: :get do %>
  <%= fields_for 'search' do |search_form| %>
    <%= search_form.search_field :email,  placeholder: 'search by email' %>
    <%= search_form.search_field :role,  placeholder: 'search by role' %>
  <% end %>
  <%= button_tag 'search' %>
<% end %>

<hr>
<div class="users">
  <% @users.each do |user| %>
    <ul class="user_info">
      <li><%= "Id/email: #{user.id}/#{user.email}" %></li>
      <li><%= "#{t('.created_at')}: #{user.created_at}" %></li>
      <li><%= "#{t('.roles')}: #{user.roles.pluck(:name).sort}" %></li>
      <li><%= link_to t('buttons.edit'),  user_edit_path(user) %></li>
    </ul>
    <div class="user_orders">
      <% if user.orders.any? %>
        <%= link_to "#{t('.quantity_of_orders')} (#{user.orders.count})", orders_path(user_id: user.id) %>
        <% user.orders.order(created_at: :desc).first(5).map do |order|  %>
          <div><%= link_to "#{t('.date')}: #{order.created_at.strftime("%d/%m/%Y %k:%M")} # #{t('.cost')}: #{order.cost}", order_path(order) %></div>
        <% end %>
      <% else %>
        <%= t('.no_order') %>
      <% end %>
    </div>
    <div class="user_block">
      <%= button_to t('.block_account'), user_update_path(user), params: {set_user_role: :blocked}, form: { data: { confirm: t('.confirmation') } }, method: :put %>
    </div>
    <hr>
  <% end %>
</div>


